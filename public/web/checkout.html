<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Freshmart | Home</title>

    <!-- Font awesome -->
    <link href="/web/css/font-awesome.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="/web/css/bootstrap.css" rel="stylesheet">
    <!-- SmartMenus jQuery Bootstrap Addon CSS -->
    <link href="/web/css/jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <!-- Product view slider -->
    <link rel="stylesheet" type="text/css" href="/web/css/jquery.simpleLens.css">
    <!-- slick slider -->
    <link rel="stylesheet" type="text/css" href="/web/css/slick.css">
    <!-- price picker slider -->
    <link rel="stylesheet" type="text/css" href="/web/css/nouislider.css">
    <!-- Theme color -->
    <link id="switcher" href="/web/css/theme-color/default-theme.css" rel="stylesheet">
    <!-- <link id="switcher" href="css/theme-color/bridge-theme.css" rel="stylesheet"> -->
    <!-- Top Slider CSS -->
    <link href="/web/css/sequence-theme.modern-slide-in.css" rel="stylesheet" media="all">

    <!-- Main style sheet -->
    <link href="/web/css/style.css" rel="stylesheet">

    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


  </head>

  <body>
    <!-- wpf loader Two -->
    <div id="wpf-loader-two">
      <div class="wpf-loader-two-inner">
        <span>Loading</span>
      </div>
    </div>
    <!-- / wpf loader Two -->
    <!-- SCROLL TOP BUTTON -->
    <a class="scrollToTop" href="#"><i class="fa fa-chevron-up"></i></a>
    <!-- END SCROLL TOP BUTTON -->


    <!-- Start header section -->
    <header id="aa-header">
      <!-- start header top  -->
      <div class="aa-header-top">
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="aa-header-top-area">

                <!-- / header top left -->
                <div class="aa-header-top-right">
                  <ul class="aa-head-top-nav-right">
                    <li class="hidden-xs"><a href="/cart">My Cart</a></li>
                    <li class="hidden-xs"><a href="/checkout">Checkout</a></li>
                    <li><a href="/signin">Logout</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- / header top  -->

      <!-- start header bottom  -->
      <div class="aa-header-bottom">
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="aa-header-bottom-area">
                <!-- logo  -->
                <div class="aa-logo">
                  <!-- Text based logo -->
                  <a href="index">
                    <span class="fa fa-shopping-cart"></span>
                    <p><strong>Freshmart</strong> <span>Your Shopping Partner</span></p>
                  </a>
                </div>
                <!-- / logo  -->

                <!-- cart box -->
                <div class="aa-cartbox">
                  <a class="aa-cart-link" href="cart">
                    <span class="fa fa-shopping-basket"></span>
                    <span class="aa-cart-title">SHOPPING CART</span>
                    <span class="aa-cart-notify">2</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- / header bottom  -->
    </header>
    <!-- / header section -->
    <!-- menu -->
    <section id="menu">
      <div class="container">
        <div class="menu-area">
          <!-- Navbar -->
          <div class="navbar navbar-default" role="navigation">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <ul class="nav navbar-nav">
              <li><a href="/web_index">Home</a></li>

              <li><a href="/web_product_category/?id=Fruits">Fruits </a>
              </li>

              <li><a href="/web_product_category/?id=Vegetables">Vegetables</a>
              </li>

              <li><a href="/web_product_category/?id=Dry%20Fruits">Dry Fruits </a>

              </li>

              <li><a href="/shop">Shop</a></li>
              <li><a href="/user_order_details">Order Details</a></li>
              <li><a href="/web_contact">Contact</a></li>

            </ul>
            <!--/.nav-collapse -->
          </div>
        </div>
      </div>
    </section>
    <!-- / menu -->

    <!-- catg header banner section -->
    <section id="aa-catg-head-banner">
      <img src="/web/img/fashion/fashion-header-bg-8.jpg" alt="fashion img">
      <div class="aa-catg-head-banner-area">
        <div class="container">
          <div class="aa-catg-head-banner-content">
            <h2>Checkout Page</h2>
            <ol class="breadcrumb">
              <li><a href="index.html">Home</a></li>
              <li class="active">Checkout</li>
            </ol>
          </div>
        </div>
      </div>
    </section>
    <!-- / catg header banner section -->

    <input type="hidden" id="productImage">
    <input type="hidden" id="productQTY">
    <input type="hidden" id="productName">
    <input type="hidden" id="productPrice">
    <input type="hidden" id="productTotal">
    <input type="hidden" id="productVendor">

    <!-- Cart view section -->
    <div class="about" style="position: relative; top: 20px;">
      <div class="container">
        <br>
        <br>
        <br>
        <h3 class="title">Payment</h3>
        <div class="about-text">
          <table class="table" id="tableData">
            <tr style="background: black; color: white;">
              <th>sl no</th>
              <th>Name</th>
              <th>QTY</th>
              <th>Rate</th>
              <th>Total Amount</th>
            </tr>
            <tbody>

            </tbody>
          </table>

          <div style="margin: auto;">
            <b>TOTAL AMOUNT : </b> <span id="totalAmount">₹ 0.00</span>
          </div>
          <div class="clearfix"> </div>

          <div class="container">
            <div class="heading_container">
              <h2>
                <br>
                <br>
                ADD SHIPPING DETAILS
                <br>
              </h2>
            </div>
            <div class="row">
              <div class="col-md-6 form-group">
                <label>Name</label>
                <input type="text" id="txtName" class="form-control">
              </div>

              <div class="col-md-6 form-group">
                <label>Mobile Number</label>
                <input type="text" id="txtMobileNo" class="form-control" maxlength="10">
              </div>

              <div class="col-md-6 form-group">
                <label>Email </label>
                <input type="text" id="txtEmail" class="form-control">
              </div>

              <div class="col-md-6 form-group">
                <label>Order Date </label>
                <input type="date" id="txtOrderDate" class="form-control">
              </div>

              <div class="col-md-12 form-group">
                <label>Address</label>
                <textarea id="txtAddress" class="form-control"></textarea>
              </div>

              <div class="col-md-6">
                <div class="detail-box">
                  <button type="button" id="payment" class="btn-submit btn btn-primary">PAYMENT</button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div><br><br><br>
      <!-- / Cart view section -->
      <!-- footer -->
      <footer id="aa-footer">
        <!-- footer bottom -->
        <div class="aa-footer-top">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <div class="aa-footer-top-area">
                  <div class="row">
                    <div class="col-md-4 col-sm-6">
                      <div class="aa-footer-widget">
                        <h3>Main Menu</h3>
                        <ul class="aa-footer-nav">
                          <li><a href="web_index">Home</a></li>
                          <li><a href="shop">Shop</a></li>
                          <li><a href="web_contact">Contact Us</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                      <div class="aa-footer-widget">
                        <div class="aa-footer-widget">
                          <h3>Products</h3>
                          <ul class="aa-footer-nav">
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Fruits</a></li>
                            <li><a href="#">Vegetables</a></li>
                            <li><a href="#">DryFruits</a></li>

                          </ul>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4 col-sm-6">
                      <div class="aa-footer-widget">
                        <div class="aa-footer-widget">
                          <h3>Contact Us</h3>
                          <address>
                            <p> Bhavani nagar, Hubli</p>
                            <p><span class="fa fa-phone"></span>+91 8861314998</p>
                            <p><span class="fa fa-envelope"></span>Freshmart_hubli@gmail.com</p>
                          </address>
                          <div class="aa-footer-social">
                            <a href="#"><span class="fa fa-facebook"></span></a>
                            <a href="#"><span class="fa fa-twitter"></span></a>
                            <a href="#"><span class="fa fa-google-plus"></span></a>
                            <a href="#"><span class="fa fa-youtube"></span></a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- footer-bottom -->
        <div class="aa-footer-bottom">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <div class="aa-footer-bottom-area">
                  <p>Copyright © 2022 <a href="">FreshMart</a> All rights reserved.</p>
                  <div class="aa-footer-payment">
                    <span class="fa fa-cc-mastercard"></span>
                    <span class="fa fa-cc-visa"></span>
                    <span class="fa fa-paypal"></span>
                    <span class="fa fa-cc-discover"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>

      <!-- jQuery library -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <!-- Include all compiled plugins (below), or include individual files as needed -->
      <script src="/web/js/bootstrap.js"></script>
      <!-- SmartMenus jQuery plugin -->
      <script type="text/javascript" src="/web/js/jquery.smartmenus.js"></script>
      <!-- SmartMenus jQuery Bootstrap Addon -->
      <script type="text/javascript" src="/web/js/jquery.smartmenus.bootstrap.js"></script>
      <!-- To Slider JS -->
      <script src="/web/js/sequence.js"></script>
      <script src="/web/js/sequence-theme.modern-slide-in.js"></script>
      <!-- Product view slider -->
      <script type="text/javascript" src="/web/js/jquery.simpleGallery.js"></script>
      <script type="text/javascript" src="/web/js/jquery.simpleLens.js"></script>
      <!-- slick slider -->
      <script type="text/javascript" src="/web/js/slick.js"></script>
      <!-- Price picker slider -->
      <script type="text/javascript" src="/web/js/nouislider.js"></script>
      <!-- Custom js -->
      <script src="/web/js/custom.js"></script>
      <script src="/web/js/print.js"></script>

  </body>

</html>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script type="text/javascript">

  var j = 0;
  var lclTotalCal = 0;
  function getBuy() {

    var formData = new FormData();
    var url = window.location.href;
    var count = window.location.href.length;
    var mainValue = url.substring(count, count - 2);
    var lclSearch = mainValue.search("=");
    if (lclSearch != -1) {
      var mainValue1 = url.substring(count, count - 1);
    } else {
      var mainValue1 = url.substring(count, count - 2);
    }
    // alert(mainValue1);

    $.ajax({

      url: "/get_buy",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {

        for (var i = 0; i < response.length; i++) {

          var totalAmt = mainValue1 * response[i].pd_price;
          // alert(totalAmt);
          if (isNaN(totalAmt)) {

          } else {
            // console.log(response);

            j = j + 1;
            $("#tableData").append('<tr><td>' + j + '</td><td>' + response[i].pd_name + '</td><td>' + mainValue1 + '</td><td>' + response[i].pd_price + '</td><td>' + totalAmt + '</td></tr>');
            lclTotalCal = lclTotalCal + (totalAmt);
          }

          if ($("#productQTY").val() == "") {
            $("#productQTY").val(mainValue1)
          } else {
            $("#productQTY").val($("#productQTY").val() + "<>" + mainValue1);
          }

          if ($("#productName").val() == "") {
            $("#productName").val(response[i].pd_name)
          } else {
            $("#productName").val($("#productName").val() + "<>" + response[i].pd_name);
          }

          if ($("#productPrice").val() == "") {
            $("#productPrice").val(response[i].pd_price)
          } else {
            $("#productPrice").val($("#productPrice").val() + "<>" + response[i].pd_price);
          }

          if ($("#productTotal").val() == "") {
            $("#productTotal").val(totalAmt)
          } else {
            $("#productTotal").val($("#productTotal").val() + "<>" + totalAmt);
          }

          $("#totalAmount").text("₹ " + lclTotalCal);
        }

      }

    });
  }
  getBuy();

  // getData();

  function getData() {

    var formData = new FormData();

    $.ajax({

      url: "/get_cart",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {

        for (var i = 0; i < response.length; i++) {
          j = j + 1;
          $("#tableData").append('<tr><td>' + j + '</td><td>' + response[i].ct_name + '</td><td>' + response[i].ct_qty + '</td><td>' + response[i].ct_rate + '</td><td>' + response[i].ct_total_amt + '</td></tr>');

          if ($("#productQTY").val() == "") {
            $("#productQTY").val(response[i].ct_qty)
          } else {
            $("#productQTY").val($("#productQTY").val() + "<>" + response[i].ct_qty);
          }

          if ($("#productName").val() == "") {
            $("#productName").val(response[i].ct_name)
          } else {
            $("#productName").val($("#productName").val() + "<>" + response[i].ct_name);
          }

          if ($("#productPrice").val() == "") {
            $("#productPrice").val(response[i].ct_rate)
          } else {
            $("#productPrice").val($("#productPrice").val() + "<>" + response[i].ct_rate);
          }

          if ($("#productTotal").val() == "") {
            $("#productTotal").val(response[i].ct_total_amt)
          } else {
            $("#productTotal").val($("#productTotal").val() + "<>" + response[i].ct_total_amt);
          }

          lclTotalCal = lclTotalCal + response[i].ct_total_amt;

        }

        $("#totalAmount").text("₹ " + lclTotalCal);

      }

    });
  }

  getData();

  function getMenu() {

    $.ajax({

      url: "/get_nav_details",
      type: "POST",
      success: function (response) {

        for (var i = 0; i < response.length; i++) {

          if (response[i].sc_category_name == "Men") {

            $("#men").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }
          if (response[i].sc_category_name == "Women") {

            $("#women").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }
          if (response[i].sc_category_name == "Kids") {

            $("#kids").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }
          if (response[i].sc_category_name == "Sports") {

            $("#sports").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }
          if (response[i].sc_category_name == "Digital") {

            $("#digital").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }
          if (response[i].sc_category_name == "Furniture") {

            $("#furniture").append('<li><a href="/web_product?id=' + response[i].sc_name + '">' + response[i].sc_name + '</a></li>');
          }

        }

      }

    });
  }

  getMenu();

  $(document).ready(function () {

    $("#payment").click(function (e) {
      //verification
      if ($("#txtName").val().trim().length < 1) {
        alert("Please Enter Full Name");
        $("#txtName").focus();
        return false;
      }

      if ($("#txtMobileNo").val().trim().length < 10) {
        alert("Please Enter Mobile number");
        $("#txtMobileNo").focus();
        return false;
      }

      if ($("#txtEmail").val().trim().length < 1) {
        alert("Please Enter Email");
        $("#txtEmail").focus();
        return false;
      }

      if ($("#txtOrderDate").val().trim().length < 1) {
        alert("Please Select Order Date");
        $("#txtOrderDate").focus();
        return false;
      }

      if ($("#txtAddress").val().trim().length < 1) {
        alert("Please Enter Address");
        $("#txtAddress").focus();
        return false;
      }

      var date = new Date();
      var date1 = d.getDate()

      var d = new Date();
      var month = d.getMonth() + 1;

      var d = new Date();
      var year = d.getFullYear();

      var lclDate = date + "-" + month + "-" + year;
      var txtDateShipping = date1 + "-" + month + "-" + year;

      var lclTotalAmt = ($("#totalAmount").text().trim()).substring(1);


      $.ajax({
        beforeSend: function () {
          // $(".btn .spinner-border").show();
          $("#payment").attr("disabled", true);
        },
        url: "/checkout/payment",
        type: "POST",
        data: {
          txtName: $("#txtName").val(),
          txtEmail: $("#txtEmail").val(),
          txtMobileNo: $("#txtMobileNo").val(),
          txtAddress: $("#txtAddress").val(),
          txtDate: lclDate,
          txtDateShipping: txtDateShipping,
          totalAmt: lclTotalAmt,
          productQTY: $("#productQTY").val(),
          productName: $("#productName").val(),
          productPrice: $("#productPrice").val(),
          productTotal: $("#productTotal").val()

        },
        success: function (result) {
          payment(lclTotalAmt);
        },
        error: function (request, error) {
          console.error(error);
        },
        complete: function () {
          // $(".btn .spinner-border").hide();
          $("#payment").attr("disabled", false);
        },
      });
    });

  });

  function payment(amount) {

    var totalAmount = amount;
    var options = {
      "key": "rzp_test_aKbqVbQ3Ciq9KZ",
      // rzp_live_fAt71isKlJSzhX
      "amount": (totalAmount * 100), // 2000 paise = INR 20
      "name": "SHOPZILLA",
      "description": "Payment",
      // "image": "https://www.w3adda.com/wp-content/uploads/2019/07/w3a-fb-dp.png",
      "handler": function (response) {
        // alert(response.razorpay_payment_id);
        // submitRegDetails(response.razorpay_payment_id);
        window.location.href = '/pay_success?name=' + $("#txtName").val() + '&email=' + $("#txtEmail").val() + '&mobile=' + $("#txtMobileNo").val() + '&amount=' + amount + '&transaction_id=' + response.razorpay_payment_id;

      },
      "prefill": {
        "contact": $("#txtMobileNo").val(),
        "email": $("#txtEmail").val(),
      },

      "theme": {
        "color": "#4caf50"
      }
    };
    var rzp1 = new Razorpay(options);
    rzp1.open();
    // preventDefault();
    // });

  }

</script>
